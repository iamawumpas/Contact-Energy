# Agent Instructions for Contact Energy Integration

## Environment & Configuration
- **Home Assistant Version:** Core 2025.12.5
- **Current Project:** Usage Data Download Feature (Phase 1: v1.4.x)
- **Protected Version:** v1.3.1 (stable branch: `stable-1.3.1`)
- **Next Milestone:** Phase 1 completion - API download & caching implementation

---

## üéØ Autonomous Actions (No Authorization Required)

### Code Development
- Bug fixes and code corrections
- Code refactoring for clarity and optimization
- Improving logging and error messages
- Writing/updating tests
- Implementing new features (when user explicitly requests them)
- Committing code changes to git (with clear, descriptive commit messages)

### Documentation
- Updating user-facing instructions in strings.json and en.json
- Writing human-friendly code comments explaining functionality
- Updating README or wiki files when explicitly requested

### General Guidelines
- **Code Quality:** Optimize for fastest execution
- **Design:** Follow https://developers.home-assistant.io/ guidelines
- **API Usage:** Reference .API_instructions.md and.API_Intructions_v2.md for Contact Energy API
- **Uncertainty:** When unsure what user is asking, STOP and ask clarifying questions
- **Code Comments:** Each piece of code must include human-friendly explanation
- **Approval Process:** Always suggest changes and wait for user approval before implementing

---

## üöÄ Release Workflow (Authorization Required)

**‚ö†Ô∏è RELEASE ONLY WHEN USER EXPLICITLY REQUESTS IT**

**Authorization Trigger:** User must explicitly say "run release X.Y.Z"

### When User Requests a Release:

1. **Acknowledge & Confirm**
   - Confirm this is a deliberate release request
   - Confirm the version number with user
   
2. **Reread Instructions**
   - Reread this file (.Agent_Instructions.md)
   - Reread .API_instructions.md and .API_Instructions_v2.md
   
3. **Write Changelog Entry**
   - Update Changelog.md with new entry at the top
   - Use format: `## [ X.Y.Z ]`
   - Include sections: ### Added, ### Fixed, ### Changed (as appropriate)
   - Changelog should be human-friendly (not code diffs), reflecting discussion context
   - Both the changelog and GitHub release summary should be identical
   
4. **Create Sentinel File**
   - Run: `touch .agent_changelog_complete`
   
5. **Wait for User**
   - User runs: `./release.sh X.Y.Z`
   - **Do NOT run release.sh yourself**

### Release Script Automation (release.sh)

**Purpose:** Automate version updates and GitHub release creation

**Usage:**
```bash
./release.sh x.y.z
```

**What release.sh Does:**
1. Validates changelog entry exists for version
2. Updates version in all files:
   - README.md (badge: ![Version](https://img.shields.io/badge/version-x.y.z-blue.svg))
   - manifest.json (version field)
   - HACS.json (version field)
3. Creates git commit with message "Release vx.y.z"
4. Creates git tag "vx.y.z"
5. Pushes commit and tag to repository
6. Creates GitHub release with automated changelog extraction

**Changelog Format (for extraction):**
```markdown
## [ x.y.z ]

### Added
- Item 1
- Item 2

### Fixed
- Item 1

## [ x.y.w ]
```

**Important Notes:**
- Changelog entry extraction is fully automated
- No additional files created by script
- Script assumes files are ready to be committed
- `release.sh` is a tool, NOT part of the integration
- Only the user can run release.sh (agent cannot initiate it autonomously)

---

## üìù Changelog Rules

### When Writing Changelog Entries:
- **Version Number:** `[ x.y.z ]` format (ONLY as specified by release.sh)
- **No Dates:** Do not include timestamps
- **Ordering:** Newest entry always at the top
- **Content:** Human-friendly explanations, not code diffs
- **Sections:** Use ### Added, ### Fixed, ### Changed as appropriate
- **Accuracy:** Use discussion context between agent and user, not file diffs

### What NOT to Include in Changelog:
- Changes to release.sh (it's a tool, not part of integration)
- Changes to assets folder (yaml files, charts, etc.)
- Internal refactoring without user-facing impact

### When to Update Changelog:
- Only when user explicitly requests "Please write the changelog for vX.Y.Z"
- Only when release.sh instructs the agent to do so
- User can request amendment/corrections anytime
- Do not autonomously update changelog outside release process

---

## üí¨ Communication Standards

### User-Facing Instructions
- All instructions for data entry (accounts, passwords, etc.) must be **human-friendly and detailed**
- Update strings.json and translations/en.json for user-facing messages
- Keep language clear and accessible

### Code Comments
- Include human-friendly explanation in every code piece
- Explain the "why" not just the "what"
- Make comments useful for future maintenance

---

## üìö Critical Instruction Files

**‚ö†Ô∏è READ THESE FILES REGULARLY - THEY CONTAIN ESSENTIAL PROJECT CONTEXT**

### Primary Reference Documents
1. **[.usage_download_tasks.md](.usage_download_tasks.md)** - Detailed implementation tasks for usage data feature
   - Phase-by-phase breakdown (v1.4.x ‚Üí v2.0.0)
   - API specifications and cache structure
   - Testing criteria and success metrics

2. **[.Agent_Instructions.md](.Agent_Instructions.md)** - This file
   - Development guidelines and standards
   - Release process and automation
   - Communication and code quality requirements

3. **[.API_instructions.md](.API_instructions.md)** - Contact Energy API documentation
   - Endpoint specifications
   - Authentication flow and headers
   - Request/response formats and examples

### üîî Reminder System - When to Reread:

- **Every 10 messages:** Check `.usage_download_tasks.md` for current phase status
- **Every 15 messages:** Review `.Agent_Instructions.md` for process compliance
- **Before implementing new features:** Review relevant documentation
- **When user mentions "tasks" or "instructions":** Immediately reread all three files
- **When starting a new session:** Read all three instruction files completely
- **When uncertain about process:** Stop and reread this file

### üìã Quick Reference

| File | Purpose | Read When |
|------|---------|-----------|
| `.usage_download_tasks.md` | Usage feature implementation plan | Every 10 msgs, before coding, when resuming |
| `.Agent_Instructions.md` | Development process & standards | Every 15 msgs, when uncertain |
| `.API_instructions.md` | API technical specifications | When coding API calls, debugging API issues |

---

## üì° Wiki Updates

**When requested to update wiki:**
- Update BOTH the local wiki files (in `/wiki` directory) AND the online repository wiki
- If unsure about what goes online vs. local, ask first
- Maintain consistency between local and online versions

---

## üìä Sensor Attribute Names

### Usage Sensor Attributes
- **Canonical hourly attributes:** `hourly_paid_usage`, `hourly_free_usage`, `hourly_usage` (alias of paid)
- **Legacy aliases (backward compatible):** `hourly_data`, `hourly_free_data`
- **Preference:** Use canonical names in new dashboards and documentation

---

## üîÑ Summary of Key Rules

| Action | Requires Authorization? | Process |
|--------|------------------------|---------|
| Bug fixes / refactoring | ‚ùå No | Just do it |
| New features | ‚úÖ Yes | Suggest changes, wait for approval |
| Creating a release | ‚úÖ Yes | Wait for explicit "Release vX.Y.Z" request |
| Running release.sh | ‚úÖ Yes | Only user runs it (you assist if asked) |
| Writing changelog | ‚úÖ Yes | Only when user requests or release.sh instructs |
| Updating wiki | ‚úÖ Yes | Ask before proceeding |
| Git commits | ‚ùå No | Commit code changes directly |
type: custom:apexcharts-card
all_series_config:
  stroke_width: 2
  type: area
  opacity: 0.5
graph_span: 8d
span:
  start: day
  offset: "-9d"
update_interval: 1h
header:
  show: true
  title: Hourly Usage over the last 8 days
  show_states: false
series:
  - entity: sensor.contact_energy_chart_hourly_0000000966tr348
    name: Usage (kWh)
    show:
      legend_value: false
    data_generator: |
      const entries = Object.entries(entity.attributes.hourly_data || {})
        .filter(([dt, value]) => typeof dt === 'string' && dt.length >= 16 && !isNaN(Date.parse(dt)))
        .sort(([a], [b]) => a.localeCompare(b));
      let prev = null;
      return entries.map(([dt, value], i) => {
        const v = Number(value);
        let usage = null;
        if (prev !== null) usage = v - prev;
        prev = v;
        return usage !== null ? [dt, usage] : null;
      }).filter(x => x);
  - entity: sensor.contact_energy_chart_hourly_free_0000000966tr348
    name: Free Usage (kWh)
    show:
      legend_value: false
    data_generator: |
      const entries = Object.entries(entity.attributes.hourly_free_data || {})
        .filter(([dt, value]) => typeof dt === 'string' && dt.length >= 16 && !isNaN(Date.parse(dt)))
        .sort(([a], [b]) => a.localeCompare(b));
      let prev = null;
      return entries.map(([dt, value], i) => {
        const v = Number(value);
        let usage = null;
        if (prev !== null) usage = v - prev;
        prev = v;
        return usage !== null ? [dt, usage] : null;
      }).filter(x => x);
apex_config:
  chart:
    height: 200px
  legend:
    show: true
    position: top
    horizontalAlign: center
    offsetY: 20
  yaxis:
    min: 0
    max: 6.5
    title:
      text: kwh
  xaxis:
    labels:
      offsetX: 36
card_mod:
  style: >
    /* FIX 1: Center the Title */

    div#header__title {
      text-align: center !important;
      width: 100%;
    }

    /* FIX 2: Reduce space between legend and chart (Targeting the internal
    components) */

    .apexcharts-legend {
      margin-top: -10px !important; 
      padding-top: 0px !important;
    }

    .apexcharts-canvas {
      margin-top: -15px !important; 
    }
